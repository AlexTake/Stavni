<head>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.1.1/model-viewer.min.js"></script>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <img id="arBtn" src="assets/image/ar.png" />
    <div id="bg" class="bg">
        <div id="modal"> 
            <model-viewer id="model" camera-controls src="assets/model/default.glb" ios-src="assets/model/blue.usdz" ar
                ar-placement="wall" alt="3D Model"> <!-- animation-name="baseAction.002" -->
                <button slot="ar-button" id="ar-button">
                    View in your space
                </button>
                <!-- <button id="anim-button">
                    Add Shutters
                </button> -->
            </model-viewer>
            <div class="controls" id="color-controls">
                <div id="1" style="background-color: #523032;" class="color"></div>
                <div id="2" style="background-color: #2D3F3B;" class="color"></div>
                <div id="3" style="background-color: #344557;" class="color"></div>
                <div id="4" style="background-color: #414144;" class="color"></div>
                <div id="5" style="background-color: #151114;" class="color"></div>
                <div id="6" style="background-color: #ECEBEA;" class="color"></div>
            </div>
            <div id="qrcode"></div>
            <div id="disclaimer">The AR feature is designed to offer a rough visualization of product appearance in your
                space; real dimensions may vary.</div>
            <img id="closeBtn" src="assets/image/close.png" />
        </div>
    </div>

    <script>
        const model = document.getElementById('model')
        const bg = document.getElementById('bg')
        const modal = document.getElementById('modal')
        const modelViewerColor = document.querySelector("model-viewer#model");
        let isMobile;
        if (navigator.userAgent.match(/Android/i)
            || navigator.userAgent.match(/webOS/i)
            || navigator.userAgent.match(/iPhone/i)
            || navigator.userAgent.match(/iPad/i)
            || navigator.userAgent.match(/iPod/i)
            || navigator.userAgent.match(/BlackBerry/i)
            || navigator.userAgent.match(/Windows Phone/i)) {
            isMobile = true;
        } else {
            isMobile = false;
        }
        if (!isMobile) {
            new QRCode(document.getElementById("qrcode"), {
                text: window.location.href,
                width: 512,
                height: 512,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
            modal.style.width = "50%"
            modal.style.height = "80%"
        }
        else {
            document.getElementById('closeBtn').style.right = '50px';
            document.getElementById('closeBtn').style.top = '50px';
            document.getElementById('disclaimer').style.display = 'flex'

            // document.getElementById('anim-button').addEventListener('click', () => {
            //     document.getElementById('anim-button').style.display = 'none'
            //     model.play({ repetitions: 1 });
            // })

            // model.addEventListener('ar-status', (event) => {
            //     if (event.detail.status == "session-started")
            //         document.getElementById('anim-button').style.display = 'flex'
            //     else if (event.detail.status == "not-presenting") {
            //         document.getElementById('anim-button').style.display = 'none'
            //         model.currentTime = 0;
            //         model.pause();
            //     }

            // });
        }


        document.getElementById('arBtn').addEventListener('click', () => {
            modal.style.display = 'flex'
            bg.style.display = 'flex'
        })

        document.getElementById('closeBtn').addEventListener('click', () => {
            modal.style.display = 'none'
            bg.style.display = 'none'
        })


        document.querySelector('#color-controls').addEventListener('click', (event) => {
            const colorString = event.target.style.backgroundColor;
            const [material] = modelViewerColor.model.materials;
            material.pbrMetallicRoughness.setBaseColorFactor(colorString);

            switch (event.target.id) {
                case '1':
                    model.setAttribute('ios-src', 'assets/model/burgundy.usdz')
                    break;
                case '2':
                    model.setAttribute('ios-src', 'assets/model/heritage_green.usdz')
                    break;
                case '3':
                    model.setAttribute('ios-src', 'assets/model/blue.usdz')
                    break;
                case '4':
                    model.setAttribute('ios-src', 'assets/model/dark-gray.usdz')
                    break;
                case '5':
                    model.setAttribute('ios-src', 'assets/model/black.usdz')
                    break;
                case '6':
                    model.setAttribute('ios-src', 'assets/model/white.usdz')
                case 'color-controls':
                    console.log(".")
                    break;
                default:
                    model.setAttribute('ios-src', 'assets/model/white.usdz')
            }
        });

    </script>
</body>